<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Graph Types</title>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    #graph3d { width: 100vw; height: 100vh; background: #fff; }
  </style>
</head>
<body>
  <div id="graph3d"></div>
  <script src="https://unpkg.com/three@0.149.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/3d-force-graph@1.74.7/dist/3d-force-graph.min.js"></script>
  <script src="https://unpkg.com/d3@5.16.0/dist/d3.min.js"></script>
  <script>
    fetch('assets/types_graph.json')
      .then(r => r.json())
      .then(data => {
        ForceGraph3D()(document.getElementById('graph3d'))
          .graphData(data)
          .nodeColor(() => '#111')
          .backgroundColor('#fff')
          .nodeOpacity(1)
          .linkColor(() => '#2196f3')
          .linkWidth(0.6)
          .linkOpacity(1)
          .nodeRelSize(12)
          .enableNodeDrag(true)
          .enableNavigationControls(true)
          .showNavInfo(false)
          .d3Force('center', d3.forceCenter(0, 0, 0))
          .d3Force('charge', d3.forceManyBody().strength(-12))
          .d3Force('link', d3.forceLink().distance(180).strength(0.7))
          .nodeThreeObject(node => {
            const faceSize = 120;
            const canvas = document.createElement('canvas');
            canvas.width = 1200;
            canvas.height = 200;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.beginPath();
            ctx.arc(faceSize / 2, faceSize / 2, faceSize / 2, 0, 2 * Math.PI);
            ctx.fillStyle = '#111';
            ctx.globalAlpha = 1;
            ctx.fill();
            ctx.restore();
            let fontSize = 160;
            const label = node.id;
            ctx.font = `bold ${fontSize}px Menlo, monospace`;
            let textWidth = ctx.measureText(label).width;
            while (textWidth > 1050 && fontSize > 24) {
              fontSize -= 2;
              ctx.font = `bold ${fontSize}px Menlo, monospace`;
              textWidth = ctx.measureText(label).width;
            }
            ctx.fillStyle = '#111';
            ctx.textAlign = 'left';
            ctx.textBaseline = 'middle';
            ctx.fillText(label, faceSize + 30, faceSize / 2);
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({map: texture});
            material.transparent = true;
            material.alphaTest = 0.05;
            const sprite = new THREE.Sprite(material);
            sprite.scale.set(80, 12, 1);
            sprite.center.set((faceSize/2)/canvas.width, (faceSize/2 + 40)/canvas.height);
            return sprite;
          });
      });
  </script>
</body>
</html>
